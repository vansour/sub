<!doctype html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sub — 链接聚合</title>
  <link rel="icon" href="/static/favicon.ico" />
  <link rel="stylesheet" href="/static/style.css?v=1" />
</head>

<body>

  <!-- 1. 全屏登录界面 -->
  <div id="login-screen" class="login-container">
    <div class="login-card">
      <div class="login-header">
        <div class="logo-icon large">S</div>
        <h2>Sub Admin</h2>
        <p class="text-muted">请登录以管理配置</p>
      </div>
      <form id="login-form">
        <div class="form-group">
          <label for="login-username">用户名</label>
          <input id="login-username" name="username" type="text" required placeholder="请输入用户名"
            autocomplete="username" />
        </div>
        <div class="form-group">
          <label for="login-password">密码</label>
          <input id="login-password" name="password" type="password" required placeholder="••••••••"
            autocomplete="current-password" />
        </div>
        <div id="login-status" class="form-status error"></div>
        <button type="submit" class="btn btn-primary btn-block btn-lg">登 录</button>
      </form>
    </div>
  </div>

  <!-- 2. 主应用界面 -->
  <div id="app-content" class="app-container hidden">
    <header class="app-header">
      <div class="header-left">
        <div class="logo-icon">S</div>
        <h1>Sub <span class="badge">Dashboard</span></h1>
      </div>
      <div class="header-right">
        <button id="btn-account" class="btn btn-outline">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          账号设置
        </button>
        <button id="btn-logout" class="btn btn-outline">登出</button>
      </div>
    </header>

    <main>
      <section class="content-card">
        <div class="card-header">
          <div style="display:flex; align-items:center; gap:12px;">
            <h2>订阅用户列表</h2>
            <span class="hint">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 5v14M19 12l-7 7-7-7" />
              </svg>
              拖拽可排序
            </span>
          </div>

          <!-- 添加用户按钮 -->
          <button id="add-user" class="btn btn-primary">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            新建用户
          </button>
        </div>
        <div class="table-responsive">
          <table id="user-table" class="modern-table">
            <thead>
              <tr>
                <th width="40%">用户名</th>
                <th width="60%" style="text-align: right;">操作</th>
              </tr>
            </thead>
            <tbody id="user-list">
              <!-- JS 渲染内容 -->
            </tbody>
          </table>
        </div>
      </section>
    </main>

    <footer>
      <p>Powered by <a href="https://github.com/vansour/sub" target="_blank">Sub</a></p>
    </footer>
  </div>

  <!-- 3. 模态框遮罩 -->
  <div id="modal-overlay" class="hidden"></div>

  <!-- 账号设置弹窗 -->
  <div id="modal-account" class="modal hidden">
    <div class="modal-header">
      <h3 id="modal-account-title">修改管理员账号</h3>
      <button class="btn-icon-close" onclick="hideModal('modal-account')">×</button>
    </div>
    <div class="modal-body">
      <!-- 新增：当前密码验证 -->
      <div class="form-group">
        <label for="account-current-password">当前密码 <span class="text-danger">*</span></label>
        <input id="account-current-password" type="password" placeholder="请输入当前密码以验证身份" />
      </div>
      <hr class="form-divider">
      <div class="form-group">
        <label for="account-username">新用户名</label>
        <input id="account-username" type="text" placeholder="输入新用户名" />
      </div>
      <div class="form-group">
        <label for="account-password">新密码</label>
        <input id="account-password" type="password" placeholder="输入新密码" />
      </div>
      <p class="form-hint">修改成功后需要重新登录。</p>
      <div id="modal-account-status" class="form-status"></div>
    </div>
    <div class="modal-footer">
      <button id="modal-account-cancel" class="btn btn-text" onclick="hideModal('modal-account')">取消</button>
      <button id="modal-account-save" class="btn btn-primary">保存更改</button>
    </div>
  </div>

  <!-- 添加/编辑用户弹窗 -->
  <div id="modal-form" class="modal hidden">
    <div class="modal-header">
      <h3 id="modal-form-title">配置用户</h3>
      <button id="modal-form-cancel-x" class="btn-icon-close">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label for="modal-form-username">用户名 <span class="text-danger">*</span></label>
        <input id="modal-form-username" type="text" placeholder="仅限字母、数字、下划线" autocomplete="off" />
      </div>

      <div class="form-group">
        <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 8px;">
          <label style="margin-bottom: 0;">订阅源列表</label>
          <div class="view-switcher">
            <button id="btn-view-list" class="btn btn-text btn-sm active">列表视图</button>
            <button id="btn-view-text" class="btn btn-text btn-sm">文本视图</button>
          </div>
        </div>

        <!-- 文本视图工具栏 (默认隐藏) -->
        <div id="text-view-tools" class="hidden" style="margin-bottom: 8px; display: flex; gap: 8px; flex-wrap: wrap; background: var(--color-bg-canvas); padding: 8px; border-radius: var(--radius-sm); border: 1px solid var(--color-stroke-subtle);">
          <div style="display: flex; gap: 4px; flex: 1; min-width: 200px;">
            <input id="search-input" type="text" placeholder="查找..." class="input-sm" style="flex: 1;" />
            <input id="replace-input" type="text" placeholder="替换为..." class="input-sm" style="flex: 1;" />
          </div>
          <div style="display: flex; gap: 4px;">
            <button id="btn-replace-all" class="btn btn-outline btn-sm">全量替换</button>
            <button id="btn-select-all" class="btn btn-outline btn-sm">全选文本</button>
          </div>
        </div>

        <div id="link-list-view">
          <div id="link-list-container" class="link-list">
            <!-- JS 渲染链接行 -->
          </div>
          <button id="btn-add-link" class="btn btn-outline btn-sm" style="margin-top: 12px; width: 100%; border-style: dashed;">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            添加订阅链接
          </button>
        </div>

        <div id="link-text-view" class="hidden">
          <textarea id="link-textarea" placeholder="每行一个订阅链接" style="width: 100%; height: 260px; font-family: monospace; resize: vertical; border-radius: var(--radius-sm); border: 1px solid var(--color-stroke-strong); padding: 10px; background: var(--color-bg-canvas); color: var(--color-text-primary);"></textarea>
        </div>

        <p class="form-hint" id="drag-hint">拖拽左侧图标可调整抓取顺序。</p>
      </div>

      <div id="modal-form-status" class="form-status"></div>
    </div>
    <div class="modal-footer">
      <button id="modal-form-cancel" class="btn btn-text">取消</button>
      <button id="modal-form-save" class="btn btn-primary">保存更改</button>
    </div>
  </div>

  <!-- 删除确认弹窗 -->
  <div id="modal-delete" class="modal hidden modal-sm">
    <div class="modal-body" style="text-align: center; padding-top: 2rem;">
      <div class="warning-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 6h18"></path>
          <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
          <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
        </svg>
      </div>
      <h3>确认删除?</h3>
      <p id="modal-delete-message" class="text-muted">此操作将永久删除该用户配置。</p>
      <div id="modal-delete-status" class="form-status error"></div>
      <div class="modal-actions-centered">
        <button id="modal-delete-cancel" class="btn btn-outline">取消</button>
        <button id="modal-delete-confirm" class="btn btn-danger">确认删除</button>
      </div>
    </div>
  </div>

  <script src="/static/script.js?v=1"></script>
</body>

</html>